<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vector Similarity Analysis</title>
    <link rel="stylesheet" href="vector-similarity.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div id="app">
      <h1>Vector Similarity Analysis</h1>

      <div class="section">
        <h2>Vector Visualization</h2>
        <p>Visualizing vector components (Index vs Value).</p>
        <div class="chart-container">
           <chart-component type="line" :data="vectorChartData" :options="vectorChartOptions"></chart-component>
        </div>
      </div>

      <div class="section">
        <h2>Performance Benchmark</h2>
        <p>Average execution time per operation (lower is better). Sorted by speed.</p>
        <div class="chart-container">
           <chart-component type="bar" :data="benchmarkChartData" :options="benchmarkChartOptions"></chart-component>
        </div>
      </div>

      <div class="section">
        <h2>Outlier Resiliency</h2>
        <div v-for="(test, index) in outlierTests" :key="index" class="test-case">
           <sortable-table
              :title="test.testCase"
              :vectors="test.vectors"
              :headers="['Function Name', 'Similarity Score']"
              :rows="test.rows"
              data-testid="outliers-table"
           ></sortable-table>
        </div>
      </div>

      <div class="section">
        <h2>Stress Tests</h2>
        <div v-for="(test, index) in stressTests" :key="index" class="test-case">
           <sortable-table
              :title="test.testCase"
              :vectors="test.vectors"
              :headers="['Function Name', 'Similarity Score']"
              :rows="test.rows"
              data-testid="stress-table"
           ></sortable-table>
        </div>
      </div>

      <div class="section">
        <h2>Similarity Comparison (Binary vs Continuous)</h2>
        <div class="comparison-container">
          <div v-for="(comp, type) in comparisonTests" :key="type" class="comparison-col">
             <sortable-table
                :title="'Type: ' + type"
                :vectors="comp.vectors"
                :headers="['Function', 'Score']"
                :rows="comp.rows"
                data-testid="comparison-table"
             ></sortable-table>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Comparison Demo Matrix</h2>
        <p>Similarity scores of Vector A vs others.</p>
        <div class="heatmap-container">
           <sortable-table
             title=""
             :headers="demoMatrixHeaders"
             :rows="demoMatrixRows"
             data-testid="demo-matrix-table"
           ></sortable-table>
        </div>
      </div>

      <div class="section">
        <h2>Nonlinear Analysis</h2>
        <p>Performance of similarity functions on nonlinear data patterns with different noise levels.</p>

        <div class="controls">
          <label for="function-type-filter">Function Type:</label>
          <select id="function-type-filter" v-model="filters.type">
            <option value="all">All Types</option>
            <option v-for="type in availableTypes" :key="type" :value="type">{{ type }}</option>
          </select>

          <label for="vector-size-filter">Vector Size:</label>
          <select id="vector-size-filter" v-model="filters.size">
            <option value="all">All Sizes</option>
            <option v-for="size in availableSizes" :key="size" :value="size.toString()">{{ size }}</option>
          </select>

          <label for="noise-level-filter">Noise Level:</label>
          <select id="noise-level-filter" v-model="filters.noise">
            <option value="all">All Levels</option>
            <option v-for="level in availableNoiseLevels" :key="level" :value="level.toString()">{{ level }}</option>
          </select>

          <button @click="applyFilters">Apply Filters</button>
          <button @click="toggleDebug" style="margin-left: 10px; opacity: 0.6; font-size: 0.8em;">Debug</button>
        </div>

        <!-- Debug Panel (Visible for testing/dev) -->
        <div id="debug-panel" v-if="showDebug && debugInfo" style="margin-top: 10px; padding: 5px; background: #eee; font-size: 0.8em; border: 1px solid #ccc;">
            <strong>Debug Info:</strong>
            Total: {{ debugInfo.totalItems }},
            Filtered: {{ debugInfo.filteredItems }},
            Filters: {{ JSON.stringify(debugInfo.filters) }}
        </div>

        <div class="chart-container">
          <chart-component v-if="nonlinearScoresData" type="bar" :data="nonlinearScoresData" :options="nonlinearScoresOptions"></chart-component>
        </div>

        <div class="chart-container">
          <chart-component v-if="nonlinearPerformanceData" type="bar" :data="nonlinearPerformanceData" :options="nonlinearPerformanceOptions"></chart-component>
        </div>

        <div v-if="nonlinearInsights && nonlinearInsights.length" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
          <h3>Key Insights:</h3>
          <ul>
            <li v-for="(insight, i) in nonlinearInsights" :key="i">{{ insight }}</li>
          </ul>
        </div>

         <div style="margin-top: 30px;">
             <h3>Detailed Results Table</h3>
             <sortable-table
                :headers="['Type', 'Size', 'Noise Type', 'Noise Level', 'Metric', 'Score', 'Time (ms)']"
                :rows="nonlinearTableRows"
                data-testid="nonlinear-table"
             ></sortable-table>
         </div>

      </div>
    </div>

    <script type="module" src="./vector-similarity.js"></script>
  </body>
</html>
